[{"kind":1,"language":"markdown","value":"# Obtener información de dispositivos IoT con XPath\n\nMuestra consultas por medio de Xpath empleando la estrucutura DTD diseñada para dispositivos con sensores físicos."},{"kind":1,"language":"markdown","value":"## 1. Listar dispositivos"},{"kind":2,"language":"xpath","value":"for $device in /devices/*\nreturn\n    map {\n        \"uuid\": string($device/identification/uuid),\n        \"user\": string($device/identification/user)\n    }"},{"kind":1,"language":"markdown","value":"## 2. Sensores en dispositivo 1"},{"kind":2,"language":"xpath","value":"for $sensors in /devices/device[1]/sensor\nreturn\n    map {\n        \"type\": string($sensors/@type),\n        \"unit\": string($sensors/@unit),\n        \"dimensions\": string($sensors/@dimensions),\n        \"resolution\": concat(string($sensors/@resolution),\" bit\")  \n    }\n"},{"kind":1,"language":"markdown","value":"## 3. Obtener muestras de un acelerómetro según el atributo de su eje"},{"kind":2,"language":"xpath","value":"for $sample in /devices/device[1]/sensor[1]/sample\nreturn\n    map {\n        \"timestamp\": string($sample/@timestamp),\n        \"x\": string($sample/data[@dimension=\"1\"]),\n        \"y\": string($sample/data[@dimension=\"2\"]),\n        \"z\": string($sample/data[@dimension=\"3\"])\n    }"},{"kind":1,"language":"markdown","value":"# Consultas con XQuery\n\nPara este ejercicio se empleará el servidor de procesamiento XML existDB.\n\nEl servidor se puede ejecutar de forma local o por medio de una imagen de Docker. Para el caso particular se aprovechará como recurso un servidor de prueba online y a github como host del documento XML.\n\n```html\nhttp://exist-db.org/exist/apps/eXide/index.html\n```\n\n## 1. Consultado identificadores de dispositivos\n\nQuery:\n\n```xquery\nxquery version \"3.0\";\ndoc(\"https://raw.githubusercontent.com/mfdogalindo/UC_SEMANTIC_WEB/master/TALLER_03%20-%20XPath/devices.xml\")\n/devices/device/identification\n```\nSalida:\n\n```xml\n<identification>\n      <uuid version=\"4\">fc19db85-ef60-4f1f-ad61-97ab5d2ffa1a</uuid>\n      <ip version=\"4\">10.10.0.123</ip>\n      <user type=\"email\">manuelgalindo@example.edu</user>\n    </identification>\n2\n<identification>\n      <uuid version=\"4\">d0e4cb91-5191-44d4-a943-02ef25a82310</uuid>\n      <user type=\"email\">manuelgalindo@example.edu</user>\n      <location>\n        <latitude>0</latitude>\n        <longitude>0</longitude>\n      </location>\n    </identification>\n```\n\n## 2. Formatear resultado anterior como HTML\n\nEntrada:\n\n```xquery\nxquery version \"3.0\";\nlet $ids := doc(\"https://raw.githubusercontent.com/mfdogalindo/UC_SEMANTIC_WEB/master/TALLER_03%20-%20XPath/devices.xml\")/devices/device/identification\n\nreturn <table><tr><th>UUID</th><th>USER</th></tr>\n{\n   for $x in $ids   \n   order by $x/uuid\n   return <tr><td>{data($x/uuid)}</td><td>{data($x/user)}</td></tr>\n}\n</table>\n```\n\nSalida: \n\n```html\n<table>\n    <tr>\n        <th>UUID</th>\n        <th>USER</th>\n    </tr>\n    <tr>\n        <td>d0e4cb91-5191-44d4-a943-02ef25a82310</td>\n        <td>manuelgalindo@example.edu</td>\n    </tr>\n    <tr>\n        <td>fc19db85-ef60-4f1f-ad61-97ab5d2ffa1a</td>\n        <td>manuelgalindo@example.edu</td>\n    </tr>\n</table>\n```\n\n## 3. Busca aquellos dispositivos que tengan al menos un sensor con tres ejes y retorna su identificador\n\nQuery:\n\n```xquery\nxquery version \"3.0\";\nfor $device in doc(\"https://raw.githubusercontent.com/mfdogalindo/UC_SEMANTIC_WEB/master/TALLER_03%20-%20XPath/devices.xml\")/devices/device\nwhere $device/sensor/@dimensions=\"3\"\nreturn $device/identification\n```\n\nSalida:\n\n```xml\n<identification>\n      <uuid version=\"4\">fc19db85-ef60-4f1f-ad61-97ab5d2ffa1a</uuid>\n      <ip version=\"4\">10.10.0.123</ip>\n      <user type=\"email\">manuelgalindo@example.edu</user>\n    </identification>\n```\n"}]